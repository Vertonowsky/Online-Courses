<!DOCTYPE html>
<html lang="pl">
<head>
    <title>Przywracanie hasła</title>

    <link rel="stylesheet" href="/css/auth.css"/>
    <link rel="stylesheet" href="/css/popup.css"/>

    <th:block th:insert="~{dependencies :: dependencies}"></th:block>

    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

</head>
<body>


        <!--
            START popup
        -->
        <div th:insert="~{popup :: popup}"></div>


        <div id="auth_content">


            <!--
                Insert left panel
            -->
            <th:block th:insert="~{rejestracja :: authLeftLoginPanel}"></th:block>



            <div class="right">

                <!--
                    START auth_container
                -->
                <div th:id="auth_container" th:if="${progress != null}">

                    <div id="password_recovery_body">

                        <!-- TODO make error window compatible with small screens. Make one version of the error style for every page -->

                        <!-- TODO Error message display window aswell -->

                        <div class="window" th:id="recovery_error_info" th:if="${progress == T(com.example.hello_world.RecoverPasswordStage).PASSWORD_CHANGED}">
                            <i class="center_icon fas fa-check-circle"></i>
                            <h2 class="subtitle"> Pomyślnie zmieniono hasło!</h2>
                            <p class="desc"> Przejdź do strony <a class="list_link" th:href="@{/logowanie}">logowania </a> i uwierzytelnij się używając nowego utworzonego hasła!</p>
                        </div>


                        <th:block th:if="${progress != T(com.example.hello_world.RecoverPasswordStage).PASSWORD_CHANGED}">
                            <div class="title_with_shadow">
                                <div class="tit_bck"></div>
                                <p class="tit_text">Zapomniałeś hasło?</p>
                            </div>

                            <p class="desc">Podaj adres email, z którym powiązane jest Twoje konto</p>
                        </th:block>


                        <!-- TODO fast recovering password displays error of cooldown -->

                        <form th:id="password_recovery_form" th:if="${progress == T(com.example.hello_world.RecoverPasswordStage).FRESH}" th:action="@{/auth/startPasswordRecoveryProcess}" method="POST">

                            <!--
                                INPUT GROUP - Input with its elements
                            -->
                            <div class="input_group">
                                <input id="data_email" class="input" type="text" name="email" autofocus autocomplete="email" oninput="checkInputData(0, AuthDataTypeEnum.Email, this.value)">
                                <label for="data_email"> Email: </label>

                                <!--
                                    TOOLTIP - Information about corectness of data
                                -->
                                <div class="tooltip">
                                    <i class="fas tooltip_icon"></i>
                                    <span class="tooltip_text"></span>
                                </div>
                            </div>



                            <div th:id="under_inputs">
                                <button type="submit" th:id="button_password_recovery" class="button_blue">Przywróć hasło <i class="fas fa-arrow-circle-right"></i></button>
                            </div>

                        </form>



                        <form th:id="new_password_form" th:if="${progress == T(com.example.hello_world.RecoverPasswordStage).NEW_PASSWORD_CREATION}" th:action="@{/auth/confirmPasswordChange}" th:object="${passwordDto}" method="POST">

                            <input th:if="${param.token != null}" type="hidden" name="token" th:value="${param.token}">

                            <!--
                                INPUT GROUP - Input with its elements
                            -->
                            <div class="input_group">
                                <input th:value="${#strings.isEmpty(dataPassword)} ? '' : ${dataPassword}" id="register_data_password" class="input" type="password" name="password" autocomplete="current-password" oninput="checkInputData(0, AuthDataTypeEnum.Password, this.value)" onfocusout="checkPasswordsEquality()">
                                <label for="register_data_password"> Nowe hasło: </label>

                                <!--
                                    TOOLTIP - Information about corectness of data
                                -->
                                <div class="tooltip">
                                    <i class="fas tooltip_icon"></i>
                                    <span class="tooltip_text"></span>
                                </div>
                            </div>




                            <!--
                                INPUT GROUP - Input with its elements
                            -->
                            <div class="input_group">
                                <input th:value="${#strings.isEmpty(dataPassword)} ? '' : ${dataPassword}" id="register_data_password_repeat" class="input" type="password" name="passwordRepeat" autocomplete="current-password" oninput="checkInputData(1, AuthDataTypeEnum.PasswordRepeat, this.value)" onfocusout="checkPasswordsEquality()">
                                <label for="register_data_password_repeat"> Powtórz hasło: </label>

                                <!--
                                    TOOLTIP - Information about corectness of data
                                -->
                                <div class="tooltip">
                                    <i class="fas tooltip_icon"></i>
                                    <span class="tooltip_text"></span>
                                </div>
                            </div>


                            <!--
                                PASSWORD STRENGTH - Bar describing the strength of the password
                            -->
                            <div id="password_strength">
                                <div id="password_strength_inside"></div>
                            </div>
                            <p id="optionalErrorInfo"> <i class='fas fa-times error'></i> Podane hasła nie są identyczne! </p>



                            <div th:id="under_inputs">
                                <button type="submit" th:id="button_password_recovery" class="button_blue">Przywróć hasło <i class="fas fa-arrow-circle-right"></i></button>
                            </div>

                        </form>

                    </div>

                </div>
                <!--
                    END auth_container
                -->



            </div>

            <a th:href="@{/}" id="button_go_back"><i style="font-size: 13px;" class="fas fa-chevron-left"></i> Strona główna</a>
            <a th:href="@{/logowanie}" id="button_go_next">Logowanie <i style="font-size: 14px;" class="fas fa-chevron-right"></i></a>

        </div>


        <script src="/js/jquery-1.11.3.js"></script>
        <script src="/js/validator.js"></script>
        <script src="/js/popup.js"></script>


</body>


<script th:inline="javascript">


    $("#password_recovery_form").submit(function(e) {
        if (!checkInputData(0, AuthDataTypeEnum.Email, document.getElementById("data_email").value)) {
            e.preventDefault(); // AVOID TO EXECUTE THE ACTUAL SUBMIT OF THE FORM.
        }
    });


    $("#new_password_form").submit(function(e) {
        let correctData = 0; // Count correct data
        if (checkInputData(0, AuthDataTypeEnum.Password, document.getElementById("register_data_password").value)) correctData++;
        if (checkInputData(1, AuthDataTypeEnum.PasswordRepeat, document.getElementById("register_data_password_repeat").value)) correctData++;

        if (correctData != 2 || document.getElementById("register_data_password").value != document.getElementById("register_data_password_repeat").value)
            e.preventDefault(); // AVOID TO EXECUTE THE ACTUAL SUBMIT OF THE FORM.
    });



    /*<![CDATA[*/
        let error = /*[[${error}]]*/ "";

        if (error != "" && error != null) {
            showPopup(error,  0);
            //checkInputData(0, AuthDataTypeEnum.Email, document.getElementById("login_data_email").value);
            // TODO checkInputData() for password aswell
        }

    /*]]>*/




</script>


</html>